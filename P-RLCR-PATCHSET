#!/bin/bash

. $(dirname $0)/functions

PATCHES=0
if [ -n "$1" ]; then
        AOSP="$1"
else
        AOSP="`pwd`"
fi

if ! [ -d "$AOSP" ] && ! [ -d "$AOSP/bionic" ] && [ -d "$AOSP"/build ]; then
        echo "This script must be run from the AOSP source directory"
        echo "or with the AOSP source directory as its first parameter."
        exit 1
fi

##################################################
################ Non-upstreamable ################
##################################################

##################################################
################ Backport ########################
##################################################
## CommandListener.cpp:  ensures to sort interfaces in alphabetical order
## http://android-review.linaro.org/18295
#apply --linaro system/netd 18295/2

## Workaround for wallpaper not shown correctly problem
apply --linaro frameworks/base 17696/1

## Bootchart parse command
## http://android-review.linaro.org/18203
apply --linaro system/core 18203/1

## vendor_libs: Allow btlinux service to run from vendor or system/vendor
## https://android-review.googlesource.com/c/platform/system/bt/+/657589
apply system/bt 657589/1

# Update PageTypeInfoParser to be less restrictive.
# https://android-review.googlesource.com/c/platform/frameworks/base/+/740602
cherrypick frameworks/base 93ca85a1724806c30b0fbc04837a7e869ba1c165

## Update prebuilt Clang to r349610.
## https://android-review.googlesource.com/c/platform/prebuilts/clang/host/linux-x86/+/891077
cherrypick prebuilts/clang/host/linux-x86 8b733c1257bb0229c8a32974c8c615d7dc1f3d18

########## FOR X15/AM6X   #####
## Start moving add_lunch_combo to Make
cherrypick build/make af2e1f84870525c64e6071ded0903c721e43a232

## ueventd: Add dynamic kernel module loading
## cherrypick system/core 9963847419f41c76ca008cf0c09e986c79f04e4c
## http://git.ti.com/android/platform-system-core/commit/949450945115165cf76f47c69b3f107a4db022f1
curl_am http://git.ti.com/android/platform-system-core/commit/949450945115165cf76f47c69b3f107a4db022f1?format=patch system/core

## revert change of "Make libdrm recovery_available" from master branch
revert external/libdrm d9aac04d6cd8fb78ad600fe4d252b94877ba39bf

## revert change of ""Convert Android.mk file to Android.bp" from master branch
revert external/libdrm 93a3ae4bab125e183b105adf981bd6044dbbf03b

## revert "Convert external/drm_hwcomposer to Android.bp"
revert external/drm_hwcomposer 57f97357b5283f6cc74849b09a46c3aa2ee79463

## temp: compatibility_matrices: added 4.19 kernel support
## http://git.ti.com/android/platform-hardware-interfaces/commit/4b03e692d337eafd0b1254bd30fa235f103409a2
curl_am http://git.ti.com/android/platform-hardware-interfaces/commit/4b03e692d337eafd0b1254bd30fa235f103409a2?format=patch hardware/interfaces

if [ -d external/u-boot ]; then
## Patch from AOSP master for mkimage
## http://android-review.linaro.org/c/platform/external/u-boot/+/20340
apply --linaro external/u-boot 20340/1
fi

## update arm64 webview.apk to tag of 73.0.3683.90
## http://android-review.linaro.org/c/platform/external/chromium-webview/+/20402
apply --linaro external/chromium-webview 20402/1

#!/bin/bash

. $(dirname $0)/functions

PATCHES=0
if [ -n "$1" ]; then
        AOSP="$1"
else
        AOSP="`pwd`"
fi

if ! [ -d "$AOSP" ] && ! [ -d "$AOSP/bionic" ] && [ -d "$AOSP"/build ]; then
        echo "This script must be run from the AOSP source directory"
        echo "or with the AOSP source directory as its first parameter."
        exit 1
fi

#######################################################
##  workaround for linaro work                   ######
#######################################################
cd device/linaro/hikey
git pull https://android.googlesource.com/device/linaro/hikey refs/changes/59/727159/2
cd -

## domain.te: Add map permissions to vendor_config_files
## http://android-review.linaro.org/#/c/device/linaro/hikey/+/19582
apply --linaro device/linaro/hikey 19582/1

## sepolicy/vendor_init.te: Allow mmap for vendor_init
## http://android-review.linaro.org/#/c/device/linaro/hikey/+/19596
apply --linaro device/linaro/hikey 19596/1

## http://android-review.linaro.org/#/c/device/linaro/hikey/+/19677
## sepolicy/system_server.te: Explicitly allow system_server to (m)map data files
apply --linaro device/linaro/hikey 19677/1

## Relax some neverallow rules
## bd3e300a1309323e02c7144202acb48f40f11946
#cherrypick system/sepolicy bd3e300a1309323e02c7144202acb48f40f11946

## integrated tests
## http://android-review.linaro.org/17155
apply --linaro device/linaro/hikey 17155/8

## enabling kernel compilation, etc
## enable kernel compilation for hikey build
## http://android-review.linaro.org/18395
apply --linaro device/linaro/hikey 18395/4

## BoardConfigCommon.mk: update to build based on kernel hisilicon-4.14 path
## http://android-review.linaro.org/18465
apply --linaro device/linaro/hikey 18465/1

## drm/hisilicon: Ensure LDI regs are properly configured.
## commit a2f042430784d86eb2b7a6d2a869f552da30edba upstream.
revert kernel/linaro/hisilicon-4.14 44df87e6dfadc423407f2b7a546396b86a37d462

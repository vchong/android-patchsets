#!/bin/bash

. $(dirname $0)/functions

PATCHES=0
if [ -n "$1" ]; then
        AOSP="$1"
else
        AOSP="`pwd`"
fi

if ! [ -d "$AOSP" ] && ! [ -d "$AOSP/bionic" ] && [ -d "$AOSP"/build ]; then
        echo "This script must be run from the AOSP source directory"
        echo "or with the AOSP source directory as its first parameter."
        exit 1
fi

function apply_amit_mainline_patch(){
    local commit_id=$1 && shift
    local target_dir="kernel/common/mainline"
    if [ -n "$1" ]; then
        target_dir=$1 && shift
    fi
    if [ -d ${target_dir} ]; then
        curl_am https://git.linaro.org/people/amit.pundir/linux.git/patch/?id=${commit_id} ${target_dir}
    fi
}

function apply_jstultz_mainline_patch(){
    local commit_id=$1 && shift
    local target_dir="kernel/common/mainline"
    if [ -n "$1" ]; then
        target_dir=$1 && shift
    fi
    if [ -d ${target_dir} ]; then
        curl_am https://git.linaro.org/people/john.stultz/android-dev.git/patch/?id=${commit_id} ${target_dir}
    fi
}
##################################################
################ Linaro hack   ###################
##################################################
## ANDROID: db845c: add db845c_gki.fragment
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=94547812194945e3e379869976ca342ff0386a42
apply_jstultz_mainline_patch 94547812194945e3e379869976ca342ff0386a42

## ANDROID: arm64: dts/sdm845: Enable FW implemented safe sequence handler on MTP
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=f2bfe0dcdb2b82144d93d85ae8691de20981a4ce
apply_jstultz_mainline_patch f2bfe0dcdb2b82144d93d85ae8691de20981a4ce
## ANDROID: arm64: dts: qcom: sdm845: Add first PCIe controller and PHY
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=17c860068340002f6d5d4456ebd3ca39cc8c73c5
apply_jstultz_mainline_patch 17c860068340002f6d5d4456ebd3ca39cc8c73c5
## ANDROID: arm64: dts: qcom: sdm845: Add second PCIe PHY and controller
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=73306d62cf2c43da4f7ccba163a6ef4ed97444ca
apply_jstultz_mainline_patch 73306d62cf2c43da4f7ccba163a6ef4ed97444ca
## ANDROID: arm64: dts: qcom: db845c: Enable PCIe controllers
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=34241234f2a3ac1d8bfd8d613867266edbb46f1a
apply_jstultz_mainline_patch 34241234f2a3ac1d8bfd8d613867266edbb46f1a
## ANDROID: arm64: dts: qcom: sdm845-db845c: Bring in LT9611
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=1ef7b3b6e6fb2aa848cebaad19b209f85a1c5a03
apply_jstultz_mainline_patch 1ef7b3b6e6fb2aa848cebaad19b209f85a1c5a03
## ANDROID: arm64: dts: db845c: add Low speed expansion i2c and spi nodes
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=b08e14b255dd07b397bf6338284bfb8541f76864
apply_jstultz_mainline_patch b08e14b255dd07b397bf6338284bfb8541f76864
## ANDROID: arm64: dts: db845c: Add clocks entry to display to track real clock inputs
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=3d52d72656ab1941b397366dce9f66fcdad1c868
apply_jstultz_mainline_patch 3d52d72656ab1941b397366dce9f66fcdad1c868

## FROMLIST: drm: msm: Quiet down plane errors in atomic_check
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=d1d70a22f5c7441253b4230995c8c75f52a283fa
apply_jstultz_mainline_patch d1d70a22f5c7441253b4230995c8c75f52a283fa
## ANDROID: drm/bridge: Introduce LT9611 DSI to HDMI bridge
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=ff0a001fb7b6737d88384e3c416f3d23753fbf10
apply_jstultz_mainline_patch ff0a001fb7b6737d88384e3c416f3d23753fbf10

## FROMLIST: tty: serial: Kconfig: Allow SERIAL_QCOM_GENI_CONSOLE to be enabled if SERIAL_QCOM_GENI is a module
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=e9bf97bfb7e05867661869bd6503c55f10728442
apply_jstultz_mainline_patch e9bf97bfb7e05867661869bd6503c55f10728442

## FROMLIST: reset: qcom-aoss: Allow CONFIG_RESET_QCOM_AOSS to be a tristate
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=0ac673a75ec735e50684da4f5d6f19037bf2aa3f
apply_jstultz_mainline_patch 0ac673a75ec735e50684da4f5d6f19037bf2aa3f

## ANDROID: usb: xhci: add firmware loader for uPD720201 and uPD720202 w/o ROM
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=f738a4bcb2e0c40a08411940b202ccace6ddd287
apply_jstultz_mainline_patch f738a4bcb2e0c40a08411940b202ccace6ddd287
## ANDROID: usb: xhci: handle uPD720201 and uPD720202 w/o ROM
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=e090079237de9500720c4c4e5f7cac5d1c6325fb
apply_jstultz_mainline_patch e090079237de9500720c4c4e5f7cac5d1c6325fb
## ANDROID: usb: xhci: Use register defined and field names
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=c17b009f6232addd47cf8299d4a96620ec50217e
apply_jstultz_mainline_patch c17b009f6232addd47cf8299d4a96620ec50217e
## ANDROID: usb: xhci: Add ROM loader for uPD720201
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=50b8f2239e17d0616b6bfd07a55a7ac29c3e9ee5
apply_jstultz_mainline_patch 50b8f2239e17d0616b6bfd07a55a7ac29c3e9ee5
## ANDROID: usb: xhci: allow multiple firmware versions
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=aa77f06c77aa2d1f352c860ea19a3f106b18a796
apply_jstultz_mainline_patch aa77f06c77aa2d1f352c860ea19a3f106b18a796
## ANDROID: usb: xhci: provide a debugfs hook for erasing rom
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=b46bcc751b773a4c40ab21db37aa018654e912fc
apply_jstultz_mainline_patch b46bcc751b773a4c40ab21db37aa018654e912fc

## ANDROID: HACK: usb: dwc3: Disable sg_supported in order to avoid USB transfer errors
## https://git.linaro.org/people/john.stultz/android-dev.git/commit/?h=dev/db845c-android-mainline&id=f09210b8deb5e7a16aa6b0da4eac389070435d26
apply_jstultz_mainline_patch f09210b8deb5e7a16aa6b0da4eac389070435d26
